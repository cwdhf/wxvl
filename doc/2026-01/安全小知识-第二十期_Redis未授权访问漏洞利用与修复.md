#  安全小知识-第二十期_Redis未授权访问漏洞利用与修复  
原创 今木安全
                        今木安全  今木安全   2026-01-22 03:30  
  
Redis因其高性能而备受青睐，但其默认配置的“零安全”策略也带来了严峻的挑战。本文将深入技术细节，解析漏洞成因、攻击手法，并提供层层递进的防护方案。  
#### 一、 漏洞原理深度剖析：从默认配置到权限失控  
1. **不安全的默认配置链**  
  
1. **绑定地址（bind）**  
： 默认配置为   
bind 127.0.0.1  
，但若管理员为方便而改为   
bind 0.0.0.0  
或直接注释掉该行，Redis将监听所有网络接口，暴露在公网。  
  
1. **保护模式（protected-mode）**  
： Redis 3.2版本引入的重要安全特性。默认值为   
yes  
。当服务器未设置密码且绑定地址为全零（  
0.0.0.0  
）时，保护模式会生效，  
**仅允许回环地址（127.0.0.1）的连接**  
。然而，一旦设置了   
bind 0.0.0.0  
并同时设置了密码，保护模式便会自动禁用，此时安全完全依赖于密码强度和网络防火墙。  
  
1. **认证密码（requirepass）**  
： 默认值为空。这是导致未授权访问的最直接原因。  
  
1. **权限提升的技术链条**  
  
攻击者连接成功后，利用Redis内置的  
CONFIG  
命令修改数据持久化路径和文件名，从而实现任意文件写入。其技术链条如下：  
```
```  
  
**技术细节**  
：  
save  
命令会阻塞Redis服务器直到文件写入完成，而  
bgsave  
会异步执行。写入的文件会包含Redis数据文件头，这可能破坏某些文件格式（如SSH密钥），但通过精心构造内容（如换行符）可以绕过。  
  
#### 二、 攻击技术扩展：从数据泄露到系统沦陷  
1. **数据层面攻击**  
  
1. **敏感信息泄露**  
：使用  
keys *  
命令模糊匹配所有键，再使用  
get  
、  
hgetall  
等命令获取业务数据、会话信息、配置信息等。  
  
1. **数据破坏**  
：  
flushdb  
清空当前数据库，  
flushall  
清空所有数据库，对业务造成毁灭性打击。  
  
1. **系统层面攻击（核心危害）**  
  
1. **前提**  
：知道Web根目录绝对路径。  
  
1. **操作**  
：写入一个可执行的脚本文件（如PHP）。  
  
1. **操作**  
：将目录设置为  
/etc/cron.d/  
，文件名任意，写入计划任务格式的恶意命令。  
  
1. **前提**  
：Redis服务以  
root  
权限运行，且目标服务器开启了SSH密码登录或存在其他漏洞。  
  
1. **操作**  
：如上文所述，将公钥写入  
/root/.ssh/authorized_keys  
。  
  
1. **细节**  
：写入的文件开头会包含Redis版本信息等乱码，需在公钥前后添加换行符以确保SSH能正确识别。  
  
1. **SSH公钥植入登录**  
：  
```
```  
  
1. **Crontab计划任务反弹Shell**  
：  
```
```  
  
1. **WebShell写入**  
：  
```
```  
  
#### 三、 高级利用技术：主从复制攻击  
  
这是比文件写入更强大的攻击方式，可用于实现远程代码执行（RCE）。  
1. **原理**  
：Redis的主从复制功能允许从库（Slave）同步主库（Master）的数据。攻击者可以控制一个恶意Redis服务器，并将其设置为目标Redis的主库。  
  
1. **步骤**  
：  
```
```  
  
1. 攻击者Redis会将自己的数据（包括恶意模块）同步给目标Redis。  
  
1. 通过  
MODULE LOAD  
命令在目标Redis上加载恶意模块，即可执行任意命令。  
  
1. 在攻击者服务器上，准备好一个包含恶意代码的Redis模块（.so文件）。  
  
1. 将目标Redis设置为攻击者Redis的从库。  
  
#### 四、 企业级纵深防护方案  
1. **网络层隔离（第一道防线）**  
```
```  
  
1. **安全组/NSG**  
：在云环境中，配置安全组规则，实现同样的网络隔离。  
  
1. **防火墙**  
：严格限制Redis端口的访问源IP，仅允许应用服务器IP段访问。  
  
1. **服务层加固（核心配置）**  
```
```  
  
1. **强制认证**  
：在  
redis.conf  
中设置  
requirepass  
一个高强度密码（长度>16位，包含大小写、数字、特殊字符）。  
  
1. **修改默认端口**  
：将端口从  
6379  
改为非常用端口，增加攻击者扫描难度。  
  
1. **限制监听地址**  
：非必要不暴露公网，生产环境应配置  
bind 127.0.0.1  
或内网IP。  
  
1. **禁用危险命令**  
：通过  
rename-command  
配置重命名或禁用高风险命令。  
  
1. **系统层权限控制**  
```
```  
  
1. **文件系统限制**  
：通过AppArmor或SELinux为Redis进程定义严格的访问控制策略，限制其只能访问必要的文件和目录。  
  
1. **低权限运行**  
：使用非root用户（如  
redis  
用户）启动Redis服务。  
  
#### 五、 检测与监控  
- **漏洞扫描**  
：定期使用内部扫描工具或授权的外部扫描服务，检查是否存在未授权访问的Redis实例。  
  
- **日志审计**  
：Redis的日志默认不记录客户端连接。需要在  
redis.conf  
中配置  
loglevel verbose  
并设置  
logfile  
路径，才能记录连接信息，便于事后溯源。  
  
- **入侵指标（IOC）监控**  
：在HIDS（主机入侵检测系统）或网络层面监控对Redis端口的异常连接、  
CONFIG  
命令的执行、以及对计划任务或SSH目录的异常写入行为。  
  
通过以上层层递进的技术防护与监控，可以极大地降低Redis未授权访问漏洞带来的风险，为企业数据安全构筑坚固的防线。  
  
