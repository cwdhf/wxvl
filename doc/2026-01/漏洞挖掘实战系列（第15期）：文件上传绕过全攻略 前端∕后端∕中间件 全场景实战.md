#  漏洞挖掘实战系列（第15期）：文件上传绕过全攻略 前端/后端/中间件 全场景实战  
原创 点击关注👉
                    点击关注👉  网络安全学习室   2026-01-19 02:38  
  
文件上传漏洞，是 Web 安全里**最容易拿 Shell、最容易出高分漏洞、最容易在 CTF 里拿分**  
的漏洞类型之一。  
  
但现实情况是：  
  
很多人遇到文件上传就“被拦到怀疑人生”——  
  
前端拦、后端拦、WAF 拦、内容检测拦、文件名检测拦、MIME 检测拦……  
  
这一期，我把文件上传绕过拆成 **前端、后端、中间件**  
 三大块，每一块都告诉你：  
- 它怎么拦  
  
- 为什么能绕  
  
- 怎么绕  
  
- 实战案例  
  
- 可直接用的 Payload  
  
你看完这一期，基本能搞定 80% 的文件上传场景。  
  
![图片](https://mmbiz.qpic.cn/sz_mmbiz_png/iaLzURuoralZbibjTiaibeyxJ0q2vahEfIquq3nuRI5tEH6qzApowCRyP9p8RRRFMUAoxWyOebfbrjETfQIhibovuYg/640?wx_fmt=png&from=appmsg&watermark=1&wxfrom=5&wx_lazy=1&tp=webp#imgIndex=0 "")  
## 一、文件上传漏洞为什么这么重要？  
  
因为它能直接让你拿到 **WebShell**  
，进而：  
- 执行命令  
  
- 读敏感文件  
  
- 提权  
  
- 拿下服务器  
  
在 CTF 里，文件上传 = 稳定拿分  
  
在 SRC 里，文件上传 = 高危漏洞（通常 500–2000 元）  
  
在渗透测试里，文件上传 = 最容易“一击必杀”的入口  
## 二、前端绕过（最容易，但很多人不知道怎么绕）  
  
前端验证通常在 JavaScript 里，比如：  
- 检查后缀名  
  
- 检查文件大小  
  
- 检查文件类型  
  
- 检查文件内容是否为图片  
  
前端验证的特点是：  
  
**完全不可信，随便绕。**  
### 1. 前端后缀验证绕过  
  
常见代码：  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/iaLzURuoralZuIxcKhej1WiaMquckK1w0nmGKib9PnfRUmcObyiaiaPZjXn3EdGpN6AV68w0HAZsVG4RZVIOFicPE2kg/640?wx_fmt=png&from=appmsg "")  
  
绕过方法：  
- 直接禁用 JavaScript  
  
- 用 Burp 抓包改后缀  
  
- 用浏览器插件禁用前端校验  
  
Payload：  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/iaLzURuoralZuIxcKhej1WiaMquckK1w0nnfznWMN3Jic66ibH2LZs7yPaGib1f05AXKMuRFmEsN64rH5B9vzTicShxg/640?wx_fmt=png&from=appmsg "")  
  
抓包改回：  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/iaLzURuoralZuIxcKhej1WiaMquckK1w0nYdfSwYlIK2ObOhMDryLrLpJqdqUkEdzZDZVEicu81GIicy2cj6zRvs3g/640?wx_fmt=png&from=appmsg "")  
### 2. 前端 MIME 类型验证绕过  
  
前端通过 accept="image/*"  
 限制文件类型。  
  
绕过方法：  
  
抓包改 Content-Type：  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/iaLzURuoralZuIxcKhej1WiaMquckK1w0na5bZbEaIDyiaptJmUPXt2enwQdg2xfjIhGCnwp0s5L6OdYujMiaq0mmQ/640?wx_fmt=png&from=appmsg "")  
### 3. 前端文件内容验证绕过（简单）  
  
前端用 JS 检查文件头是否为图片。  
  
绕过方法：  
  
在 PHP 文件前加 GIF 头：  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/iaLzURuoralZuIxcKhej1WiaMquckK1w0n0vGpuvZibdwL8CpX0u8p8ibse3zXfrJMELQJfGESKltYQz2Eo3auPejw/640?wx_fmt=png&from=appmsg "")  
  
前端以为是图片，后端执行 PHP。  
## 三、后端绕过（真正的难点，这里讲最实用的）  
  
后端验证主要有：  
- 后缀名检测  
  
- MIME 检测  
  
- 文件内容检测  
  
- 路径检测  
  
- 文件名过滤  
  
- 黑名单/白名单  
  
下面我按“最常见 → 最绕”的顺序讲。  
### 1. 后缀名黑名单绕过  
  
常见黑名单：  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/iaLzURuoralZuIxcKhej1WiaMquckK1w0nHd5kkoc8nWBPp0vsXhTSwsLIAqTszs2n6NicpKyq3Nty21k9o4TqjVw/640?wx_fmt=png&from=appmsg "")  
  
绕过方法：  
- 用少见后缀：php7  
、pHp  
、PhP  
  
- 用 Windows 特性：shell.php.  
、shell.php空格  
  
- 用 Linux 特性：shell.php%00.jpg  
  
- 用 Apache 解析漏洞：shell.php.x  
  
Payload 示例：  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/iaLzURuoralZuIxcKhej1WiaMquckK1w0nPq0Mbx8VcPicZhiadNyXSTJLmCl4745PgNpMpxBpq5yL4qWib7mx6u5SA/640?wx_fmt=png&from=appmsg "")  
### 2. 后缀名白名单绕过  
  
白名单只允许：  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/iaLzURuoralZuIxcKhej1WiaMquckK1w0ngichSyJbUDmYtKwr0LoAqYmmJLnpI85Rc1NQbO3pjXGlquokjzuib72Q/640?wx_fmt=png&from=appmsg "")  
  
绕过方法：  
- 利用文件包含漏洞配合上传  
  
- 利用中间件解析漏洞  
  
- 利用文件内容混淆  
  
示例：  
  
上传 shell.jpg  
，内容为：  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/iaLzURuoralZuIxcKhej1WiaMquckK1w0nfDuuaib4icq33mtfA3qwhd0m5YGRyoWmc443TGPklxJsXhZicMmic55X4A/640?wx_fmt=png&from=appmsg "")  
  
然后通过文件包含漏洞执行：  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/iaLzURuoralZuIxcKhej1WiaMquckK1w0nsXLva0aHzhzZBVhm4TwltyrjsnQOqlmK2PJhzGibialDlRvzK34omx5g/640?wx_fmt=png&from=appmsg "")  
### 3. MIME 类型检测绕过  
  
后端用 $_FILES['file']['type']  
 判断类型。  
  
绕过方法：  
  
抓包改 Content-Type：  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/iaLzURuoralZuIxcKhej1WiaMquckK1w0nibAKGicg2KOoAQc60D2No2xfa9QbXQ67apmQATUtdBWEicSHR8C44xH5A/640?wx_fmt=png&from=appmsg "")  
### 4. 文件内容检测绕过（图片马）  
  
后端用 exif_imagetype()  
、getimagesize()  
 检测是否为图片。  
  
绕过方法：  
- 加图片头  
  
- 加真实图片内容  
  
- 用 polyglot 文件  
  
图片马示例：  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/iaLzURuoralZuIxcKhej1WiaMquckK1w0n6eREBQDfH2mYO3MBmJgwOQ8ibiaY6Gq1slULIOpntice93YkfS8v4cDibg/640?wx_fmt=png&from=appmsg "")  
  
或直接用真实图片 + PHP 代码：  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/iaLzURuoralZuIxcKhej1WiaMquckK1w0nwzfnyUwyFVQMypcBn2tIZrpXL8yXWY7icevGQTiaHRicNhmWYiaq4VvPqw/640?wx_fmt=png&from=appmsg "")  
### 5. 文件名过滤绕过  
  
后端过滤危险字符：  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/iaLzURuoralZuIxcKhej1WiaMquckK1w0nnLiat9xL74reEpJiaJJhibytRfFaefIkkNPcL4Dapniakq4RuKSsHXYa0Q/640?wx_fmt=png&from=appmsg "")  
  
绕过方法：  
  
双写绕过：  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/iaLzURuoralZuIxcKhej1WiaMquckK1w0nS5n7rFmUxviaGNDstkKAQyo00OQTXXWBELLXdxmx6TYico9oZZBtrLTQ/640?wx_fmt=png&from=appmsg "")  
  
后端替换后变成：  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/iaLzURuoralZuIxcKhej1WiaMquckK1w0nfZuIYPTwzeJ2xnd9E7WsgxdxqQ9vwfwPzGz29sP9lnXvIOCBvic009Q/640?wx_fmt=png&from=appmsg "")  
### 6. 路径检测绕过  
  
后端把文件名拼接到路径：  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/iaLzURuoralZuIxcKhej1WiaMquckK1w0nlEcjwzUc8a97gXWNNkuIkzfSX0cskoC1upnicM3HdPuleAlFogLkJDw/640?wx_fmt=png&from=appmsg "")  
  
绕过方法：  
  
目录穿越：  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/iaLzURuoralZuIxcKhej1WiaMquckK1w0nqxGbPOXynjo4zGibS79NhicM4kQMGAdTbNnJqvRpuD0n71d4RDLtmI1g/640?wx_fmt=png&from=appmsg "")  
## 四、中间件绕过（文件上传的“终极绕法”）  
  
中间件解析漏洞往往能直接突破所有限制。  
### 1. Apache 解析漏洞（CVE-2017-15715）  
  
影响版本：  
  
Apache 2.4.0–2.4.29  
  
漏洞原理：  
  
Apache 会把 shell.php.xxx  
 解析为 PHP。  
  
Payload：  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/iaLzURuoralZuIxcKhej1WiaMquckK1w0nMs5dvr7MxkDeGYKxV6QHj1Bl2YPt7aBr9icyVQOzrljkiaUMdoHFBoBg/640?wx_fmt=png&from=appmsg "")  
### 2. Nginx 解析漏洞  
  
情况 1：Nginx 错误配置  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/iaLzURuoralZuIxcKhej1WiaMquckK1w0ntJjcOD2ylWzBUKQZqah5YuQmuWVIPjom47bMIRZq6KjOgALttH7PDw/640?wx_fmt=png&from=appmsg "")  
  
上传 shell.jpg  
，访问：  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/iaLzURuoralZuIxcKhej1WiaMquckK1w0nTysaPmfZ48EFiaKbu5S24wOMFBBJgA790KuLxWW6bGHEqJK3ia30sicbg/640?wx_fmt=png&from=appmsg "")  
  
Nginx 会把它交给 PHP 解析。  
  
情况 2：Nginx 文件名逻辑漏洞  
  
上传：  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/iaLzURuoralZuIxcKhej1WiaMquckK1w0naP2rnJyI60Sq2MPxSiaDkcQeYqxickvCwQrJpM2RCmZCR5KKFicl0DRCQ/640?wx_fmt=png&from=appmsg "")  
  
或  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/iaLzURuoralZuIxcKhej1WiaMquckK1w0nNE3aPUuSlsTpUEYTbQmxyzMbsXwGWNb14jr6EvicDSlqaqjGGjV8TjA/640?wx_fmt=png&from=appmsg "")  
### 3. IIS 解析漏洞  
  
IIS 6.0 经典漏洞：  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/iaLzURuoralZuIxcKhej1WiaMquckK1w0nAggvcLHRheESYd9lGR65edcuolODqEuOl6uGW3UEiahYBeRTvbsolew/640?wx_fmt=png&from=appmsg "")  
  
IIS 会把前面的 asp  
 当成脚本后缀。  
## 五、文件上传实战案例（CTF + 真实场景）  
### 案例 1：前端校验 + 后端黑名单绕过  
  
场景：  
  
只能上传 jpg/png，后端黑名单过滤 php。  
  
绕过步骤：  
1. 上传 shell.php.jpg  
  
1. 抓包改名为 shell.php%00.jpg  
  
1. 后端截断，保存为 shell.php  
  
1. 访问 getshell  
  
Payload：  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/iaLzURuoralZuIxcKhej1WiaMquckK1w0n4Zwxl3yibeWJ0k9DDK77tGtV0AwDy3WJhnvFKbBVnM2CiajhP586WllQ/640?wx_fmt=png&from=appmsg "")  
### 案例 2：图片马 + 文件包含  
  
场景：  
  
后端严格校验文件内容必须为图片。  
  
绕过步骤：  
1. 制作图片马：cat 1.jpg shell.php > shell.jpg  
  
1. 上传 shell.jpg  
  
1. 找到文件包含漏洞：/include.php?file=./uploads/shell.jpg  
  
1. getshell  
  
### 案例 3：Apache 解析漏洞  
  
场景：  
  
后端限制后缀为 jpg。  
  
绕过步骤：  
1. 上传 shell.php.xxx  
  
1. 访问 shell.php.xxx  
  
1. Apache 解析为 PHP  
  
## 六、文件上传绕过总结（最实用的 10 条）  
1. 前端校验 = 随便绕（抓包改就行）  
  
1. 黑名单 = 找“漏网之鱼”后缀  
  
1. 白名单 = 图片马 + 文件包含  
  
1. 内容检测 = 加图片头  
  
1. 文件名过滤 = 双写绕过  
  
1. Windows 特性 = .  
 和空格  
  
1. Linux 特性 = %00  
 截断  
  
1. Apache = .php.xxx  
  
1. Nginx = shell.jpg/.php  
  
1. IIS = asp;.jpg  
  
## 七、福利  
  
文件上传漏洞是“最容易拿 Shell”的漏洞类型，掌握这一期内容，你在 CTF 和 SRC 里都能稳定挖洞。  
  
**200节攻防教程，限时领！**  
  
想要的兄弟，**关注我+在后台发“想学”**  
，直接免费分享！  
  
![图片](https://mmbiz.qpic.cn/sz_mmbiz_jpg/iaLzURuoralZbibjTiaibeyxJ0q2vahEfIquLRP3PDAic2VxEic9qgkKgsnRpfiaicIGgEgZHWzq39jKmfVGVXjUr9ZOCw/640?wx_fmt=jpeg&from=appmsg&watermark=1&wxfrom=5&wx_lazy=1&tp=webp#imgIndex=17 "")  
  
咱学漏洞挖掘和CTF，光看文章不够，这套教程里全是**实战演示**  
——从工具配置到漏洞利用，每一步都手把手教，跟着练就能上手！  
  
（注：资源领取入口在公众号后台，关注后发“学习”自动弹链接）  
  
### 下期预告  
  
第16期将带来《SSRF 高级利用：攻击内网、攻击云服务、攻击 Redis》，这是挖 SRC 最容易出高危漏洞的方向之一，千万不要错过！  
  
