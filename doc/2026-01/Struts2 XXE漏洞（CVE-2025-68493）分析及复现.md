#  Struts2 XXE漏洞（CVE-2025-68493）分析及复现  
 天黑说嘿话   2026-01-15 00:53  
  
   
  
# CVE-2025-68493  
## 漏洞点  
  
位置：com.opensymphony.xwork2.util.DomHelper.parse  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/GcusaH7xzyicEZBjkd0HVR2RJUiaiaSfPFPciclMaJxNdrd3CrgcaelAxmO3PRsQy1WHhhbuU3KnbsMt21PwY0qxVA/640?wx_fmt=png&from=appmsg "")  
  
## 环境  
  
java：  
```
import com.opensymphony.xwork2.util.DomHelper;import org.w3c.dom.Document;import org.xml.sax.InputSource;import java.io.IOException;import java.io.StringReader;public class Test {    public static void main(String[] args) throws IOException {        String xmlContent = "<?xml version=\"1.0\"?><!DOCTYPE root [<!ENTITY xxe SYSTEM \"file:///etc/passwd\">]><root>&xxe;</root>";        InputSource inputSource = new InputSource(            new StringReader(xmlContent)        );        Document document = DomHelper.parse(inputSource);        if (document != null && document.getDocumentElement() != null) {            System.out.println(document.getDocumentElement().getTextContent());        }    }}
```  
  
struts：  
```
package com.y5neko.vul.action;import com.opensymphony.xwork2.ActionSupport;import com.opensymphony.xwork2.util.DomHelper;import org.w3c.dom.Document;import org.xml.sax.InputSource;import java.io.StringReader;public class XmlParserNoDtdAction extends ActionSupport {    private String xmlContent;    private String result;    private String error;    public String execute() {        return SUCCESS;    }    public String parse() {        try {            if (xmlContent == null || xmlContent.trim().isEmpty()) {                error = "XML 内容不能为空";                return ERROR;            }            InputSource inputSource = new InputSource(                new StringReader(xmlContent)            );            Document document = DomHelper.parse(inputSource);            if (document != null && document.getDocumentElement() != null) {                result = document.getDocumentElement().getTextContent();                addActionMessage("XML 解析成功");            } else {                error = "XML 解析失败";                return ERROR;            }        } catch (Exception e) {            StringBuilder sb = new StringBuilder();            sb.append(e.getClass().getSimpleName());            if (e.getMessage() != null) {                sb.append(": ").append(e.getMessage());            }            error = sb.toString();            e.printStackTrace();            return ERROR;        }        return SUCCESS;    }    public String getXmlContent() {        return xmlContent;    }    public void setXmlContent(String xmlContent) {        this.xmlContent = xmlContent;    }    public String getResult() {        return result;    }    public void setResult(String result) {        this.result = result;    }    public String getError() {        return error;    }    public void setError(String error) {        this.error = error;    }}
```  
## 分析  
  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/GcusaH7xzyicEZBjkd0HVR2RJUiaiaSfPFPSK730Am6WfUAPIcIOTuf5wdQ9YcjUISTQ46mOjjoIEVFbwXrwIzWqw/640?wx_fmt=png&from=appmsg "")  
  
进入重载方法，dtdMappings为null  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/GcusaH7xzyicEZBjkd0HVR2RJUiaiaSfPFPRiajRkhTGgiceaSX3DnFSeho4CDPG9CpAry9WRSPf59g150LicmoOrSIA/640?wx_fmt=png&from=appmsg "")  
  
使用SAXParserFactory作为factory  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/GcusaH7xzyicEZBjkd0HVR2RJUiaiaSfPFPDVxGx13Nh3vGfxTmeTicToYicUKUKge1ME031JsMxM4rg68WfgiaDI9Zg/640?wx_fmt=png&from=appmsg "")  
  
直接进入SAXParserImpl的parse方法，依次跟进  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/GcusaH7xzyicEZBjkd0HVR2RJUiaiaSfPFPAwmibmKK0mLqkVZCrPvs3JaYdXiatcr74BcyPoz7e2e4thNUERwodib1A/640?wx_fmt=png&from=appmsg "")  
  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/GcusaH7xzyicEZBjkd0HVR2RJUiaiaSfPFPShia9JBJcbMhj49qbH58F6Pf1AAbWsUnA7OWeJnWwoWvWVFa86s6iaJA/640?wx_fmt=png&from=appmsg "")  
  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/GcusaH7xzyicEZBjkd0HVR2RJUiaiaSfPFP3HXGFZTTG7EqUqWVWpRhKRVO9FvFWKuYiay1jWnuzD5d7HtgBULcHsw/640?wx_fmt=png&from=appmsg "")  
  
直到com.sun.org.apache.xerces.internal.parsers.parse  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/GcusaH7xzyicEZBjkd0HVR2RJUiaiaSfPFPNUiaLtJ4EI9VVibUoNWPU3kdOibqBiaseEggqScJPtxeIpP3W7QEice6Dvg/640?wx_fmt=png&from=appmsg "")  
  
securityPropertyManager负责管理JAXP安全属性  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/GcusaH7xzyicEZBjkd0HVR2RJUiaiaSfPFP24k84RbbEEHxsOwvuuk5TRgIF9mYAvWGrFJUy6PGQSwQVwofpX4zicg/640?wx_fmt=png&from=appmsg "")  
  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/GcusaH7xzyicEZBjkd0HVR2RJUiaiaSfPFPKtg579BDz3zHVxbQiaj8IYNA6ngQwGaz7ekGAb7WGXSjHGhthj79NAQ/640?wx_fmt=png&from=appmsg "")  
  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/GcusaH7xzyicEZBjkd0HVR2RJUiaiaSfPFPt43UXj7TMx1BPlcPDWIqib0XF3Dp5fYVt2FjflGgqkicib2uacDR7FBug/640?wx_fmt=png&from=appmsg "")  
  
其中ACCESS_EXTERNAL_DTD和ACCESS_EXTERNAL_SCHEMA分别决定DTD阶段和XML Schema (XSD)阶段是否允许访问外部实体，默认为all，即允许所有协议，参考：  
  
https://docs.oracle.com/en/java/javase/25/docs/api/java.xml/javax/xml/XMLConstants.html[#ACCESS]()  
_EXTERNAL_DTD  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/GcusaH7xzyicEZBjkd0HVR2RJUiaiaSfPFP0fgzucOCgKVw8AebMLEW1RDTKv4RWq9K0VBU9d0yFMic1XZ6AlN6nlA/640?wx_fmt=png&from=appmsg "")  
  
继续回到执行点  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/GcusaH7xzyicEZBjkd0HVR2RJUiaiaSfPFPhmmqpCUo0o48J7GWI4IxeJ56pGaCQDEXno785oF4tMzvwgPibjZbbnA/640?wx_fmt=png&from=appmsg "")  
  
随后就是内部的xml解析逻辑，完整调用链如下：  
```
DomHelper.parse()  ↓SAXParser.parse()  ↓XMLParser.parse()  ↓XML11Configuration.parse()  ↓XMLEntityManager.startEntity()  ↓XMLScanner.scanDocument()  ↓XMLDTDScannerImpl.scanDTD()  ↓XMLDocumentScannerImpl.scanStartElement()  ↓XMLSchemaValidator / ContentHandler
```  
## 复现  
  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/GcusaH7xzyicEZBjkd0HVR2RJUiaiaSfPFP1LCo8S11NCia26U4s4g5UDGeicmxoueAiazDQUiaLzf2NUmCZe63eoIKNg/640?wx_fmt=png&from=appmsg "")  
  
## 修复  
  
1、升级Struts2版本；  
  
2、jvm参数直接置空 XML 解析器的三个安全参数；  
```
-Djavax.xml.accessExternalDTD=""-Djavax.xml.accessExternalSchema=""-Djavax.xml.accessExternalStylesheet=""
```  
  
  
   
  
  
