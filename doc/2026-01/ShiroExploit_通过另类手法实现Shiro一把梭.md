#  ShiroExploit_通过另类手法实现Shiro一把梭  
原创 ptr
                    ptr  UpRoot   2026-01-21 00:30  
  
### 前言  
  
攻防博弈发展至今，常规工具的流量特征早已被安全设备精准标记、清晰识别，也正因如此，各类经二次开发、魔改后的工具应运而生。  
  
目前很多关于Shiro反序列化漏洞利用的工具是基于@SummerSec所写的ShiroAttack2魔改来的，这一类工具因为打内存马的方式、以及内存马模板都没有动，包括探测利用链的方式、跑Key的方式都原封不动，导致ShiroAttack2有啥问题，以此魔改的工具就有啥问题。  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/xVRYUEtHibmvtCv8GeE6GcSuJ7ySsuO2l2Rkrc385LicEMQm2xGX1lAJgPstXpUZNrvKdnMUw4kDUQiazdYE2rl1g/640?wx_fmt=png&from=appmsg "")  
  
ShiroAttack2明显的流量特征如下有：  
  
1、请求头中有Authorization: Basic d2hvYW1p  
后面是命令的Base64，回显结果被$$$  
包含。  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/xVRYUEtHibmvtCv8GeE6GcSuJ7ySsuO2lRtusR78l45MEoFS5zKeqMXPicxpvnrQhYicSYF5Vwh6HKkGxGhIT6TlQ/640?wx_fmt=png&from=appmsg "")  
  
2、其采用内存马分离加载，请求头中有内存马的密码和请求路径，回显出现->|Success|<-  
字样。  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/xVRYUEtHibmvtCv8GeE6GcSuJ7ySsuO2lB3JORh22U8hEkeZO0oTuxpOyMzpLm9wu14ENQURgOU4Y52KDBb1H7Q/640?wx_fmt=png&from=appmsg "")  
  
这样特征很容易被安全设备标记，蓝队看监控看着设备弹出来告警后，你可能连持久化还没做就被关站下线了。  
  
SummerSec师傅写的这款工具很具有实战价值、参考学习价值，但他已经快三年没有更新这款工具了，很多已知bug仍未修复，或许内部有更完善的版本并未开源出来。就针对目前的版本来说，对我而言，确实用来不是很顺手。  
  
为了避免重复造轮子，因此我决定通过不一样的利用方式写一个我顺手的工具出来。  
### ShiroExploit  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/xVRYUEtHibmvtCv8GeE6GcSuJ7ySsuO2lX0Z2clGZNMtSbib8tsZodicYmUIlXaQx2b2k19UlGquwdiaaU7LW4UeAg/640?wx_fmt=png&from=appmsg "")  
  
ShiroExploit，是一款Shiro反序列化漏洞一站式综合利用工具。  
  
基本概述如下：  
  
1、区分ShiroAttack2，采用分块传输内存马，每块大小不超过4000。  
  
2、可打JDK高版本的shiro，确保有key、有gadget就能rce。  
  
3、依托JavaChains动态生成gadget，实现多条利用链，如CB、CC、Fastjson、Jackson。  
  
4、通过魔改MemshellParty的内存马模板，使其回显马通信加密，去除一些典型的特征。  
  
5、借助JMG的注入器，加以魔改，实现无侵入性，同一个容器可同时兼容多种类型的内存马。  
  
6、对内存马和注入器类名进行随机化和Lambda化处理，规避内存马主动扫描设备的检测。  
  
7、可以更改目标配置，如改Key、改TomcatHeaderMaxSize。  
  
8、采用URLDNS链和反序列化炸弹的方式来探测指定类实现利用链的探测。  
  
9、缺点是流量相对大一些。  
### 功能演示  
  
JDK18场景下实现命令执行和打入多种内存马。  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/xVRYUEtHibmvtCv8GeE6GcSuJ7ySsuO2lZ6ZDofm5ovL9bn8NI7kic1pMFibMjSJnYuVhGMpWQ8rgphicFwUZ2vT6w/640?wx_fmt=png&from=appmsg "")  
  
跑key。  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/xVRYUEtHibmvtCv8GeE6GcSuJ7ySsuO2l0ZX9fMGS5IIXDblaJGviaRdGuY73okvKiaYN9Rv2ichgbksXicxut2aib0A/640?wx_fmt=png&from=appmsg "")  
  
探测利用链。  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/xVRYUEtHibmvtCv8GeE6GcSuJ7ySsuO2lXo8EBGj4MBofLXNtAxWJ334BqTdBALtWhOibGzxGDcICLjbdPmsiaFSw/640?wx_fmt=png&from=appmsg "")  
  
命令执行。  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/xVRYUEtHibmvtCv8GeE6GcSuJ7ySsuO2lHgc3oeLu18B9esq5Zs80pk1iaKgY0rYh1w3oDagZAZDqVHibVqhJssjg/640?wx_fmt=png&from=appmsg "")  
  
打入Godzilla内存马（支持Behinder内存马）。  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/xVRYUEtHibmvtCv8GeE6GcSuJ7ySsuO2lB9hKt82yuPBHUExPEdAVbPpiaBRLmRicoo8T5nDAPC4exLiatOFq0eXZw/640?wx_fmt=png&from=appmsg "")  
  
打入SUO5V2内存马。  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/xVRYUEtHibmvtCv8GeE6GcSuJ7ySsuO2lW8NT3fhU6pJ3MnA6ZLjEQOSFYQWBraZE8R9R64Knpq8ImByIBvnFSA/640?wx_fmt=png&from=appmsg "")  
  
支持Tomcat10及以上的内存马。  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/xVRYUEtHibmvtCv8GeE6GcSuJ7ySsuO2lkaLvqwxENJkmF7bPd8RDaXXMib1mhz7atlMAjEwL6BS3HWILakUEF3Q/640?wx_fmt=png&from=appmsg "")  
  
**项目地址：https://github.com/FightingLzn9/ShiroExploit**  
  
期待这款工具，能够给你带来新的体验。  
  
在无人问津的地方训练。  
  
- END -  
###   
  
  
