#  AdonisJS 任意文件写(CVE-2026-21440) 漏洞复现  
 船山信安   2026-01-14 09:00  
  
## 组件简介  
  
  
AdonisJS 是一个功能完善的 Node.js 后端框架。该框架从零开始构建，重点强调开发者体验和易用性。  
  
  
它是 Node.js 社区中较为少见的框架之一，内置了一整套官方的一方（first-party）功能包，帮助开发者在无需花费数百小时拼装各种 npm 包的情况下，就能完成产品的开发与交付。  
  
## 影响版本  
  
  
bodyparser < v10.1.2  
  
## 环境搭建   
  
  
GPT 梭一个简单的 web  
  
  
app.js  
  
```
import express from 'express'
import { MultipartFile } from '@adonisjs/bodyparser'
import { Form } from '@poppinss/multiparty'

const app = express()

app.get('/', (req, res) => {
  res.send(`
    <!DOCTYPE html>
    <html>
    <head>
      <title>File Upload</title>
      <style>
        body { font-family: Arial; max-width: 600px; margin: 50px auto; padding: 20px; }
        form { border: 2px dashed #ccc; padding: 30px; text-align: center; }
        input[type="file"] { margin: 20px 0; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; cursor: pointer; }
        button:hover { background: #0056b3; }
      </style>
    </head>
    <body>
      <h1>File Upload</h1>
      <form action="/upload" method="POST" enctype="multipart/form-data">
        <input type="file" name="file" required>
        <br>
        <button type="submit">Upload</button>
      </form>
    </body>
    </html>
  `)
})

app.post('/upload', (req, res) => {
  const form = new Form()

  form.parse(req, (err, fields, files) => {
    if (err) {
      return res.status(400).json({ error: err.message })
    }

    const uploadedFile = files.file?.[0]
    if (!uploadedFile) {
      return res.status(400).json({ error: 'No file uploaded' })
    }

    const file = new MultipartFile({
      fieldName: 'file',
      clientName: uploadedFile.originalFilename,
      headers: uploadedFile.headers,
    }, {})

    file.tmpPath = uploadedFile.path
    file.size = uploadedFile.size

    file.move('./uploads').then(() => {
      res.json({
        success: true,
        filename: file.fileName,
        size: file.size
      })
    }).catch(err => {
      res.status(500).json({ error: err.message })
    })
  })
})

app.listen(3333, () => {
  console.log('Server running on http://localhost:3333')
})

```  
  
  
  
package.json  
  
```
{
  "name": "file-upload-service",
  "version": "1.0.0",
  "type": "module",
  "scripts": {
    "dev": "node app.js"
  },
  "dependencies": {
    "@adonisjs/bodyparser": "10.1.1",
    "@poppinss/multiparty": "^2.0.0",
    "express": "^4.18.0"
  }
}

```  
## 分析过程  
  
  
body_parser.spec.ts  
  
![](https://mmbiz.qpic.cn/mmbiz_png/7nIrJAgaibicOCL1T2qcewib6Q7jAaAjLcZQxKvguOrtHKLcxgfYEwDaXTlpshpfvOjSYtFDMKQ4sQbtNLPAlPJ9A/640?wx_fmt=png&from=appmsg "")  
  
overwrite 默认为 true name 则使用用户上传的文件名  
  
![](https://mmbiz.qpic.cn/mmbiz_png/7nIrJAgaibicOCL1T2qcewib6Q7jAaAjLcZYgSqwaSoY86mVX2ECDJA4nqgv8SDsvz2Uac0k2wLmQNicc6QwtPhB9A/640?wx_fmt=png&from=appmsg "")  
  
![](https://mmbiz.qpic.cn/mmbiz_png/7nIrJAgaibicOCL1T2qcewib6Q7jAaAjLcZ2Tia5nUNcm0mdo6M8NYKxb0NnI3hCB5nj8l3icJkVwe4PywFjYOAVtEA/640?wx_fmt=png&from=appmsg "")  
  
然后使用 path.join 进行拼接  path.join 无限制 直接拼接  
  
  
这里就是漏洞成因  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/7nIrJAgaibicOCL1T2qcewib6Q7jAaAjLcZNV2dsnoeNlMY3Ho7laGN8Cm8j0Cc5hA60hDMBmbLMgHR0g2YeRib42g/640?wx_fmt=png&from=appmsg "")  
  
![](https://mmbiz.qpic.cn/mmbiz_png/7nIrJAgaibicOCL1T2qcewib6Q7jAaAjLcZAQTPChM6mEmaacauLHW8sha1ExiaL6P14g0iac2b2D0dxMbSDunjZCjg/640?wx_fmt=png&from=appmsg "")  
## 修复方案  
  
  
高版本不再使用用户提供的参数作为参数  
  
![](https://mmbiz.qpic.cn/mmbiz_png/7nIrJAgaibicOCL1T2qcewib6Q7jAaAjLcZuu6F4puvoGCTASN1ib2evjeBLBttUl4gMhAickicZiciaYKJAiab2GpI3v1A/640?wx_fmt=png&from=appmsg "")  
  
