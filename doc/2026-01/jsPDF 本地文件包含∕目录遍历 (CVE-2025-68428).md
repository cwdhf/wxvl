#  jsPDF 本地文件包含/目录遍历 (CVE-2025-68428)  
原创 棉花糖糖糖  棉花糖fans   2026-01-07 08:19  
  
![](https://mmbiz.qpic.cn/mmbiz_gif/1mtwZURvGTkCK3ZFyqYEyTwmaLo2YSMeibz3eeShkewiadS4oh0RBl1U7BTVeEscGQrEbjWKcQzGpJEFLwr4cFQw/640?wx_fmt=gif&wxfrom=13&wx_lazy=1&tp=wxpic "")  
  
  
## 前言  
  
CVE-2025-68428，jsPDF项目的目录穿越导致本地文件包含，文中poc仅供合法测试，用于企业自查，切勿用于非法测试，未授权测试造成后果由使用者承担，与本公众号无关。  
## 漏洞概述  
  
此漏洞源于 jsPDF (Node.js 构建版) 的部分方法（loadFile, addImage, html, addFont）未对用户传入的文件路径进行严格的过滤与校验。远程攻击者可构造包含路径遍历序列（如 ../）的恶意请求，绕过预期的资源目录限制，读取服务器上的敏感文件（如配置文件、密钥等），并将文件内容嵌入到生成的 PDF 文档中。  
## 漏洞原理  
  
官方好像下架了其他漏洞版本，我只在github找到jsPDF 3.0.4版本，基于这个版本做的分析。  
  
在dist/jspdf.node.js文件的第 15903行有一个暴露给用户的jsPDFAPI.loadFile：  
  
![](https://mmbiz.qpic.cn/mmbiz_png/lic4LrsB27nuRh0YWIeLbcZ66O3UPnLWsdHHCC2VdHmwiauibqVmUgpAibQicuaCakrZWfNMMcoORkHd2KvxQ1xkMrQ/640?wx_fmt=png&from=appmsg "")  
实际执行函数为nodeReadFile，就在下面一点位置就找到了，函数是这样的：  
```
  function nodeReadFile(url, sync, callback) {
    sync = sync === false ? false : true;
    var result = undefined;

    var fs = require("fs");
    var path = require("path");

    url = path.resolve(url);
    if (sync) {
      try {
        result = fs.readFileSync(url, { encoding: "latin1" });
      } catch (e) {
        return undefined;
      }
    } else {
      fs.readFile(url, { encoding: "latin1" }, function(err, data) {
        if (!callback) {
          return;
        }
        if (err) {
          callback(undefined);
        }
        callback(data);
      });
    }

    return result;
  }
})(jsPDF.API);

```  
  
问题出在这个函数传参url值并没有做安全校验，但用了path.resolve做路径处理，当用户传入类似../../../etc/passwd的恶意值时，它会主动解析../这样的序列，向上遍历文件夹，然后生成绝对路径并赋值给后面的url参数，最终传递给readFileSync直接读取了文件，造成漏洞。  
  
官方github中给了一个本地验证的poc  
```
import { jsPDF } from "./dist/jspdf.node.js";

const doc = new jsPDF();

doc.addImage("./secret.txt", "JPEG", 0, 0, 10, 10);
doc.save("test.pdf"); // the generated PDF will contain the "secret.txt" fileimport osos.system('ls') 

```  
  
鉴于jsPDF貌似不会单独出现，一般是作为别的产品的引用功能，所以我做了一个仿真的环境，利用有漏洞的功能加载pdf文件模版，用户前端传参读取产品目录下的模版文件，恶意传参读取文件获取flag。  
  
![](https://mmbiz.qpic.cn/mmbiz_png/lic4LrsB27nuRh0YWIeLbcZ66O3UPnLWsJzkAAunOz2PNcusT24l3ribeicoliaO3sYiaia1K7v5vv0phnCfn8maUe6w/640?wx_fmt=png&from=appmsg "")  
  
环境已在无境中上架：vip.bdziyi.com/ulab，无境，英文名Unbounded Lab，是专为网络安全学习者打造的综合性实战平台，提供真实企业级漏洞环境，让您在安全的环境中提升实战技能，核心特色：独立隔离环境，每位用户都拥有**完全独立**  
的靶场环境，即使是庞大的内网靶场，环境之间也是**零干扰**  
，确保您的学习过程不受任何影响。  
  
![](https://mmbiz.qpic.cn/mmbiz_png/lic4LrsB27nuRh0YWIeLbcZ66O3UPnLWsUvplp2Gz0j0zQNlCaDMicyJLYleVgpvkP6Pbu4Ah4mXVXOa1EJIrw8w/640?wx_fmt=png&from=appmsg "")  
## 广告时间：  
  
[棉花糖会员站介绍(25年11月15日版本) 新增在线独立环境内网靶场](https://mp.weixin.qq.com/s?__biz=MzkyOTQzNjIwNw==&mid=2247492813&idx=1&sn=0bb0698488bfc8a03b1ed0983be803fd&scene=21#wechat_redirect)  
  
  
  
