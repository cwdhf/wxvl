#  2个由注册点导致垂直越权的漏洞案例  
 船山信安   2026-01-13 09:00  
  
# 注册点导致垂直越权  
  
## 案例一  
  
## 登录框  
  
  
开局依然是登录框起手  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/7nIrJAgaibicMcmaq1jHvaSibnTUEYeicdSO8GlcCRbs5tTgtibkdhJKD0iaGMaaDPB1G76SjOI2dUzjOOwKYVpia1nhA/640?wx_fmt=png&from=appmsg "")  
  
  
但是存在注册点  
  
  
那么我们先尝试能否注册并继续测试  
  
  
我们先启动我们的bp 挂在后台抓数据  
  
![](https://mmbiz.qpic.cn/mmbiz_png/7nIrJAgaibicMcmaq1jHvaSibnTUEYeicdSOibaOE7VociaQourw6708YggUbEfvVjEyltfKibPITzNr28ADPMjfI8QbQ/640?wx_fmt=png&from=appmsg "")  
  
当抓取注册点的数据包时 发现存在一个user.utype字段  
  
  
一开始是0 我后面修改成1  
  
  
最后发现成功注册为管理员用户了  
  
![](https://mmbiz.qpic.cn/mmbiz_png/7nIrJAgaibicMcmaq1jHvaSibnTUEYeicdSOeotFnWDu4czA9113aVmK1ZsmhjqSwqz47pJw8FCMQRTQRYFxrwicZ8A/640?wx_fmt=png&from=appmsg "")  
## 测试功能点  
  
  
经典管理员账户  
  
  
经典可以对用户和用户信息进行增删改查操作  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/7nIrJAgaibicMcmaq1jHvaSibnTUEYeicdSOeqWMRUADWYl4660WE600C67iaLcXicwqDIKiaUaTZ0nIafLM0xmvOjk9A/640?wx_fmt=png&from=appmsg "")  
  
  
存在大量泄露信息的接口  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/7nIrJAgaibicMcmaq1jHvaSibnTUEYeicdSOzsXniahwngDbsrLIo4AF1YQ7QZu07iae1dWSlQKZx5QnI6orEraCcmDA/640?wx_fmt=png&from=appmsg "")  
  
  
因为是报名系统 所有里面都是学生的家庭信息  
  
  
敏感信息也是狠狠的被泄露了  
  
  
测试过程中发现这个站点是个老站点  
  
  
一看这个前端就很老 还是前后端未分离的  
  
  
并且cookie部分没有做鉴权操作  
  
  
那么很自然的就想到创建普通用户尝试越权操作  
  
  
随便创建了一个普通用户  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/7nIrJAgaibicMcmaq1jHvaSibnTUEYeicdSOMCBibms8uGROCcdn8qMZbyX0hM6lINKgAqfTr0oHpHgueECibicC672IQ/640?wx_fmt=png&from=appmsg "")  
  
  
在刚刚以管理员测试的时候 发现大部分的api都是通过.do文件进行操作的 典型的java web  
  
  
那么我们现在拿着已知的api 放到普通用户上面测试看看能不能越权操作  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/7nIrJAgaibicMcmaq1jHvaSibnTUEYeicdSOGxeS8PnT1KTPxVzWEzxRSUcC9ORnoQDy1kWYic8Dicqj6Hz59wGwDSBA/640?wx_fmt=png&from=appmsg "")  
  
  
这是一个用户查询的接口 后面跟着userid  
  
  
以普通用户访问这个接口  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/7nIrJAgaibicMcmaq1jHvaSibnTUEYeicdSOyarPUqTwkSicOQ3OTbZgSluuCIz9peNmq1q2RAD58EPRKx84Eyb5W7g/640?wx_fmt=png&from=appmsg "")  
  
  
成功越权查看他人信息   
  
  
看来这个操作是可行的  
  
  
那么接下来就继续举一反三即可  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/7nIrJAgaibicMcmaq1jHvaSibnTUEYeicdSOhOcywSzISoWmXp3VbdcBWYOOzgKJE5OXEuYNgaRjodxnb122iaib7xJg/640?wx_fmt=png&from=appmsg "")  
  
  
接了个列表接口  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/7nIrJAgaibicMcmaq1jHvaSibnTUEYeicdSOth4PnvoVa45e80MicP9HYHxNU9A1JNfsLs6NTQsZqjh8VurNbyC0puQ/640?wx_fmt=png&from=appmsg "")  
  
  
虽然没有直接回显数据  
  
  
但是点击导出到excel就可以成功下载全站用户的信息  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/7nIrJAgaibicMcmaq1jHvaSibnTUEYeicdSOcPlZNPq6eTKricWXGQuibTLibMfpicehiaL70SichAnNAG9d139SOWCibRf8g/640?wx_fmt=png&from=appmsg "")  
  
  
至此这个站点基本能测试的都已经被我们测试完了  
  
## 案例二  
  
## 登录框  
  
  
依旧登录框起手  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/7nIrJAgaibicMcmaq1jHvaSibnTUEYeicdSO9Cy8MBKFRia1kLnuSCq5M5Vsj5lWAw1avtRJiaOicoskCIiadV7Qyb9ticw/640?wx_fmt=png&from=appmsg "")  
  
  
是一个实验平台  
  
  
我们点击右上角登录  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/7nIrJAgaibicMcmaq1jHvaSibnTUEYeicdSOjrZibxggx1lgGXAxf4coBEP4icPxj5NrHXibmvf7Q2zP3UxR9C5SPOp8Q/640?wx_fmt=png&from=appmsg "")  
  
  
很幸运 依然存在注册接口  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/7nIrJAgaibicMcmaq1jHvaSibnTUEYeicdSOdDlYRN6dHISGwBmc3cbuEg71bnaRUXKkdqlLHoGnvPzrlMPSJZI7xA/640?wx_fmt=png&from=appmsg "")  
  
  
随便写点东西然后点击注册并抓包  
  
![](https://mmbiz.qpic.cn/mmbiz_png/7nIrJAgaibicMcmaq1jHvaSibnTUEYeicdSONenk9iaAfEqS6VtF8RUd3svXOPPXKkJ6Wj0IickI5iaD5qWOI2ZvIMx5w/640?wx_fmt=png&from=appmsg "")  
  
依旧是注册接口存在一个roleid  
  
  
我们修改为1并放包  
  
  
成功注册管理员用户  
  
![](https://mmbiz.qpic.cn/mmbiz_png/7nIrJAgaibicMcmaq1jHvaSibnTUEYeicdSOUuiaZZYCSJ3eaJ6wJcmh5I5rrFXibK9oWVVGznR6ZpczSgUWG8NsLOrA/640?wx_fmt=png&from=appmsg "")  
## 测试功能点  
  
  
是管理员用户  
  
  
可以对站内用户信息增删改查  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/7nIrJAgaibicMcmaq1jHvaSibnTUEYeicdSOGYK6icvwkg8JH2n6ial8NXeZjtLKUUEBicU1mDx6Y7OQRnC9keFxbqxFg/640?wx_fmt=png&from=appmsg "")  
  
  
可惜 这个站点并没有什么值得测试的接口  
  
  
就是一个普通的后台  
  
  
爽爽拿下二个站点  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/7nIrJAgaibicMcmaq1jHvaSibnTUEYeicdSOwTvRtibkVZgF1P21VCicHVHy2fW48EnST4gSVvj6qYfUJvWHmoTyNhsw/640?wx_fmt=png&from=appmsg "")  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/7nIrJAgaibicMcmaq1jHvaSibnTUEYeicdSOtdKjiczrKkGe6CSR1qxslu9roicrianVjXGR90XGg7ea15lM1pfMkwGvw/640?wx_fmt=png&from=appmsg "")  
  
## 总结一下  
  
  
登录框有注册点的话 一定要尝试注册用户 记得开启bp查看具体数据包的情况  
  
  
可能在数据包中就存在判断用户类型的字段 可能导致垂直越权接管管理员用户  
  
来源：https://xz.aliyun.com/  感谢【sakuya】  
  
